:root{
  --wood-1:#5e3d26;
  --wood-2:#7a5132;
  --wood-3:#8b5a3c;
  --beige:#f2e4c9;
  --beige-deep:#e6d1a9;
  --ink:#2b1c12;
  --accent:#f0b93a;
  --card:#f9f4ea;
  --shadow:0 8px 20px rgba(0,0,0,.18);

  /* Locks sizing */
  --lock-gap: 18px;
  --lock-size: 86px; /* default */
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
  background:
    linear-gradient(0deg, rgba(0,0,0,.05), rgba(0,0,0,.05)),
    repeating-linear-gradient(90deg, var(--wood-2) 0 220px, var(--wood-1) 220px 440px);
  color:#2d2200;
}

/* ===== Top bar ===== */
.topbar{
  background:linear-gradient(#6f492f,#573520);
  color:#ffecc7;
  box-shadow: var(--shadow);
  position:sticky; top:0; z-index:5;
}
.topbar-inner{
  max-width:1100px; margin:0 auto; padding:14px 18px;
  display:flex; align-items:center; justify-content:space-between;
}
.title{
  margin:0; letter-spacing:4px; font-weight:900; font-size:28px; text-shadow:0 2px 0 rgba(0,0,0,.25);
}
.icon-btn{
  background:rgba(255,255,255,.08); border:0; border-radius:10px; color:#ffecc7;
  padding:8px 10px; margin-left:8px; cursor:pointer;
}
.icon-btn:hover{ background:rgba(255,255,255,.18); }

/* ===== Layout ===== */
#app{
  max-width:1100px; margin:18px auto; padding:0 18px;
  display:grid; grid-template-columns: 1fr 280px; gap:22px;
}
.play-area{ display:flex; flex-direction:column; gap:14px; }

/* ===== Locks row ===== */
.locks-strip{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.05));
  border-radius:16px; padding:10px 14px; box-shadow: var(--shadow);
  overflow:hidden;
}
.locks{
  display:flex;
  gap: var(--lock-gap);
  justify-content:center;
  align-items:center;
  flex-wrap: nowrap; /* one row */
}
.lock{
  width: var(--lock-size);
  height: var(--lock-size);
  position:relative;
}
.lock img{ width:100%; height:100%; object-fit:contain; transition:transform .2s; }
.lock.jiggle img{ animation:jiggle .5s; }
.lock.failed img{ filter:brightness(.55) }
@keyframes jiggle{
  0%{transform:rotate(0)} 25%{transform:rotate(-10deg)} 50%{transform:rotate(10deg)}
  75%{transform:rotate(-5deg)} 100%{transform:rotate(0)}
}

/* ===== Parchment board ===== */
.board-wrap{
  background:linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,0));
  border-radius:20px; padding:14px; box-shadow: var(--shadow);
}
.parchment{
  position:relative; padding:18px 18px 22px;
  background: radial-gradient(120% 120% at 50% -10%, #fff5db 0%, var(--beige) 60%, var(--beige-deep) 100%);
  border-radius:24px; border:3px solid rgba(0,0,0,.15);
  box-shadow: inset 0 10px 25px rgba(0,0,0,.12);
}

/* Grid: columns set dynamically by JS based on board.cols */
#letter-grid,
#letter-grid.grid{
  display:grid; gap:10px; justify-content:center;
}

.letter{
  width:74px; height:74px; border-radius:16px;
  background:#f6e7c5; border:2px solid #7a5836; color:#2b1c12;
  display:flex; align-items:center; justify-content:center;
  font-size:28px; font-weight:900; letter-spacing:1px;
  text-shadow:0 1px 0 #fff7e0;
  box-shadow:0 2px 0 #b18a5b, 0 6px 14px rgba(0,0,0,.15);
  transition:transform .06s, background .2s, border-color .2s;
}
.letter.used{ opacity:.45; pointer-events:none; filter:saturate(.6) }
.letter.invalid{ animation:shake .35s }
@keyframes shake{
  0%{transform:translateX(0)} 25%{transform:translateX(-5px)} 50%{transform:translateX(5px)}
  75%{transform:translateX(-3px)} 100%{transform:translateX(0)}
}

/* Prevent selecting/highlighting letters while dragging */
#letter-grid, #letter-grid .letter{
  user-select:none; -webkit-user-select:none; -ms-user-select:none; -moz-user-select:none;
  -webkit-tap-highlight-color:transparent; touch-action:none;
}
.no-select{ user-select:none!important; -webkit-user-select:none!important; }
#letter-grid img, #locks img{ -webkit-user-drag:none; user-drag:none; }

/* ===== Sidebar ===== */
.sidebar{ display:flex; flex-direction:column; gap:16px; }
.card{
  background:var(--card); border-radius:16px; padding:14px; box-shadow: var(--shadow);
  border:2px solid rgba(0,0,0,.08);
}

/* Progress card */
.progress-card{
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:center;
  gap:10px;
  background:#fff8e8;
  border-color:#e3cfa6;
}
.hearts{ display:flex; gap:8px; }
.heart{ width:24px; height:24px; object-fit:contain; filter:none; transition:filter .2s, opacity .2s; }
.heart.lost{ filter:grayscale(1) brightness(.6); opacity:.7; }
.scrolls{ display:flex; align-items:center; gap:10px; justify-self:end; }
.scroll-icon{
  width:28px; height:28px; object-fit:contain;
  transform: rotate(45deg);
}
.scroll-count{ font-weight:900; color:#5a3d1e; font-size:18px; }

/* Theme card */
.theme-card{ display:flex; flex-direction:column; gap:6px; background:#fff8e8; border-color:#e3cfa6; }
.theme-label{ font-size:12px; font-weight:800; text-transform:uppercase; letter-spacing:.08em; color:#8a6a3e; }
.theme-value{ font-size:18px; font-weight:900; color:#5a3d1e; }

/* Legend */
.legend ul{ list-style:none; padding:0; margin:0; display:grid; gap:8px; }
.legend li{ display:flex; align-items:center; gap:10px; font-weight:700; color:#4a3826; }
.legend-key{ width:22px; height:22px; object-fit:contain; }

/* ===== NEW: Smithing panel ===== */
.smith.card{ display:flex; flex-direction:column; gap:12px; }
.smith-card{
  background:linear-gradient(180deg,#fff9eb,#f6ebcf);
  border:2px solid #d6c19a;
  border-radius:16px;
  padding:14px;
  box-shadow: var(--shadow);
}
.smith-top{
  display:flex; align-items:center; justify-content:space-between; gap:14px;
}

/* Drop slots */
.drop-slot{
  width:96px; height:96px;
  border-radius:14px;
  background:#fff7e2;
  border:2px dashed #cba96e;
  box-shadow: inset 0 3px 10px rgba(0,0,0,.05);
  display:flex; align-items:center; justify-content:center;
  position:relative;
  flex:0 0 auto;
}
.drop-slot .slot-hint{
  position:absolute; bottom:8px; left:50%; transform:translateX(-50%);
  font-size:11px; font-weight:800; color:#b08b51; opacity:.7; pointer-events:none;
}
.drop-slot.hover{ background:#fff3d2; outline:3px dashed rgba(169,123,42,.5); outline-offset:2px; }
.drop-slot.has-key .slot-hint{ display:none; }

/* Plus icon */
.plus-icon{
  flex:1; display:flex; align-items:center; justify-content:center;
  color:#b08749; font-size:22px; font-weight:900; opacity:.6;
}

/* Forge button */
.forge-btn{
  width:100%; margin-top:10px;
}
.forge-btn:disabled{
  opacity:.6; filter:grayscale(30%); cursor:not-allowed;
}

/* Smith panel feedback */
@keyframes smithStrike {
  0%{box-shadow:0 0 0 rgba(255,208,96,0)}
  30%{box-shadow:0 0 26px rgba(255,208,96,.7)}
  100%{box-shadow:0 0 0 rgba(255,208,96,0)}
}
#smith.strike{ animation: smithStrike .6s ease-out; }
#smith.shake{ animation: invShake .32s; }

/* Trash bin (icon-only) */
.trash-bin{
  background: radial-gradient(120% 120% at 50% -10%, #fff1f1 0%, #ffe7e7 60%, #f6d5d5 100%);
  border:2px dashed #e2b2b2;
  border-radius:14px;
  padding:18px 10px;
  display:flex; align-items:center; justify-content:center;
}
.trash-bin .trash-icon{ font-size:28px; opacity:.6 }

/* Inventory dock */
.inventory-dock{
  grid-column: 1 / 2;
  margin:16px 0 28px;
  padding:0;
  display:flex;
  justify-content:center;
}
.inventory{
  background:linear-gradient(180deg,#fff8e8,#f6ebcf);
  border:2px solid #d9c59b; border-radius:16px; box-shadow: var(--shadow);
  padding:12px 14px;
  display:inline-block;
}
.inventory h2{ display:none; }
.inventory-section{ background:transparent; box-shadow:none; padding:0 }
.key-grid{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-start; padding:10px; }
.inv-slot{
  width:56px; height:56px; border-radius:10px; background:#fff7e2;
  border:2px solid #d6ba84; box-shadow: inset 0 2px 8px rgba(0,0,0,.06);
  display:flex; align-items:center; justify-content:center; flex:0 0 56px;
}

/* Keys */
.key{
  width:48px; height:48px; max-width:48px; max-height:48px;
  border:1px solid #6f5a3e; border-radius:10px; background:#fff;
  box-shadow:0 2px 4px rgba(0,0,0,.1);
  object-fit:contain; -webkit-user-drag:element; user-drag:element; cursor:grab;
}
.key:active{ transform:scale(.96) }
.key.carried{ outline:2px dashed rgba(0,0,0,.15); outline-offset:2px; }

/* Inventory full shake */
@keyframes invShake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }
.inventory.full { animation:invShake .3s }

/* Popup: simple message + actions */
.popup{ position:fixed; inset:0; z-index:50; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.35); }
.popup.hidden{ display:none; }
.popup-card{
  min-width:300px; max-width:80vw; background:#fff8e8; border:2px solid #e3cfa6; border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.25); padding:16px 18px; text-align:center;
}
#popup-text{ font-weight:800; color:#5a3d1e; white-space:pre-line; }
.popup-actions{ display:flex; gap:10px; justify-content:center; margin-top:12px; }
.btn{
  border:2px solid #d1b379; background:#fff7dd; color:#5a3d1e; font-weight:800; padding:8px 12px; border-radius:10px; cursor:pointer;
}
.btn:hover{ background:#ffefc5; }
.btn.primary{ background:#ffe3a3; border-color:#c9a051; }
.btn.primary:hover{ background:#ffd777; }

/* Popup: durability / gamble bar */
.dur-card{
  min-width:340px; max-width:88vw; background:#fffdf4; border:2px solid #ead8b3; border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.25); padding:16px 18px; text-align:center;
}
.dur-title{ font-weight:900; color:#5a3d1e; margin-bottom:10px; }
.dur-bar{
  position:relative; height:26px; border-radius:14px; overflow:hidden; border:2px solid #ccb487; background:#f8f0d9;
  display:flex; width:320px; margin:0 auto 8px;
}
.dur-red{ background:#f4b5b5; height:100%; }
.dur-green{ background:#bff0c3; height:100%; flex:1; }
.dur-cursor{
  position:absolute; top:-6px; width:24px; height:38px; border-radius:6px; background:#fff; border:2px solid #a97b2a;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
  left:0; transform:translateX(-50%);
}
.dur-caption{ font-weight:700; color:#5a3d1e; }

/* Toast (unused) */
.toast{ margin-top:8px; font-weight:700; color:#3b5d27; text-shadow:0 1px 0 #fff }

/* Accessibility focus */
.lock:focus-within img, .drop-slot:focus-within, .letter:focus{
  outline:3px solid #ffcc66; outline-offset:3px;
}
