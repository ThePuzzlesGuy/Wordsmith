:root{
  --wood-1:#5e3d26;
  --wood-2:#7a5132;
  --wood-3:#8b5a3c;
  --beige:#f2e4c9;
  --beige-deep:#e6d1a9;
  --ink:#2b1c12;
  --accent:#f0b93a;
  --card:#f9f4ea;
  --shadow:0 8px 20px rgba(0,0,0,.18);

  /* Locks sizing */
  --lock-gap: 18px;
  --lock-size: 86px; /* default */
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
  background:
    linear-gradient(0deg, rgba(0,0,0,.05), rgba(0,0,0,.05)),
    repeating-linear-gradient(90deg, var(--wood-2) 0 220px, var(--wood-1) 220px 440px);
  color:#2d2200;
}

/* ===== Top bar ===== */
.topbar{
  background:linear-gradient(#6f492f,#573520);
  color:#ffecc7;
  box-shadow: var(--shadow);
  position:sticky; top:0; z-index:5;
}
.topbar-inner{
  max-width:1100px; margin:0 auto; padding:14px 18px;
  display:flex; align-items:center; justify-content:space-between;
}
.title{
  margin:0; letter-spacing:4px; font-weight:900; font-size:28px; text-shadow:0 2px 0 rgba(0,0,0,.25);
}
.icon-btn{
  background:rgba(255,255,255,.08); border:0; border-radius:10px; color:#ffecc7;
  padding:8px 10px; margin-left:8px; cursor:pointer;
}
.icon-btn:hover{ background:rgba(255,255,255,.18); }

/* ===== Layout ===== */
#app{
  max-width:1100px; margin:18px auto; padding:0 18px;
  display:grid; grid-template-columns: 1fr 280px; gap:22px;
}
.play-area{ display:flex; flex-direction:column; gap:14px; }

/* ===== Locks row ===== */
.locks-strip{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.05));
  border-radius:16px; padding:10px 14px; box-shadow: var(--shadow);
  overflow:hidden;
}
.locks{
  display:flex;
  gap: var(--lock-gap);
  justify-content:center;
  align-items:center;
  flex-wrap: nowrap; /* one row */
}
.lock{
  width: var(--lock-size);
  height: var(--lock-size);
  position:relative;
}
.lock img{ width:100%; height:100%; object-fit:contain; transition:transform .2s; }
.lock.jiggle img{ animation:jiggle .5s; }
.lock.failed img{ filter:brightness(.55) }

@keyframes jiggle{
  0%{transform:rotate(0)} 25%{transform:rotate(-10deg)} 50%{transform:rotate(10deg)}
  75%{transform:rotate(-5deg)} 100%{transform:rotate(0)}
}

/* ===== Parchment board ===== */
.board-wrap{
  background:linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,0));
  border-radius:20px; padding:14px; box-shadow: var(--shadow);
}
.parchment{
  position:relative; padding:18px 18px 22px;
  background: radial-gradient(120% 120% at 50% -10%, #fff5db 0%, var(--beige) 60%, var(--beige-deep) 100%);
  border-radius:24px; border:3px solid rgba(0,0,0,.15);
  box-shadow: inset 0 10px 25px rgba(0,0,0,.12);
}

/* Grid: columns set dynamically by JS based on board.cols */
#letter-grid,
#letter-grid.grid{
  display:grid; gap:10px; justify-content:center;
}

.letter{
  width:74px; height:74px; border-radius:16px;
  background:#f6e7c5; border:2px solid #7a5836; color:#2b1c12;
  display:flex; align-items:center; justify-content:center;
  font-size:28px; font-weight:900; letter-spacing:1px;
  text-shadow:0 1px 0 #fff7e0;
  box-shadow:0 2px 0 #b18a5b, 0 6px 14px rgba(0,0,0,.15);
  transition:transform .06s, background .2s, border-color .2s;
}

.letter.used{ opacity:.45; pointer-events:none; filter:saturate(.6) }
.letter.invalid{ animation:shake .35s }

@keyframes shake{
  0%{transform:translateX(0)} 25%{transform:translateX(-5px)} 50%{transform:translateX(5px)}
  75%{transform:translateX(-3px)} 100%{transform:translateX(0)}
}

/* Prevent selecting/highlighting letters while dragging */
#letter-grid, #letter-grid .letter{
  user-select:none; -webkit-user-select:none; -ms-user-select:none; -moz-user-select:none;
  -webkit-tap-highlight-color:transparent; touch-action:none;
}
.no-select{ user-select:none!important; -webkit-user-select:none!important; }
#letter-grid img, #locks img{ -webkit-user-drag:none; user-drag:none; }

/* ===== Sidebar ===== */
.sidebar{ display:flex; flex-direction:column; gap:16px; }
.card{
  background:var(--card); border-radius:16px; padding:14px; box-shadow: var(--shadow);
  border:2px solid rgba(0,0,0,.08);
}

/* Progress card */
.progress-card{
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:center;
  gap:10px;
  background:#fff8e8;
  border-color:#e3cfa6;
}
.hearts{ display:flex; gap:8px; }
.heart{ width:24px; height:24px; object-fit:contain; filter:none; transition:filter .2s, opacity .2s; }
.heart.lost{ filter:grayscale(1) brightness(.6); opacity:.7; }
.scrolls{ display:flex; align-items:center; gap:10px; justify-self:end; }
.scroll-icon{
  width:28px; height:28px; object-fit:contain;
  transform: rotate(45deg);
}
.scroll-count{ font-weight:900; color:#5a3d1e; font-size:18px; }

/* Theme card */
.theme-card{ display:flex; flex-direction:column; gap:6px; background:#fff8e8; border-color:#e3cfa6; }
.theme-label{ font-size:12px; font-weight:800; text-transform:uppercase; letter-spacing:.08em; color:#8a6a3e; }
.theme-value{ font-size:18px; font-weight:900; color:#5a3d1e; }

/* Legend */
.legend ul{ list-style:none; padding:0; margin:0; display:grid; gap:8px; }
.legend li{ display:flex; align-items:center; gap:10px; font-weight:700; color:#4a3826; }
.legend-key{ width:22px; height:22px; object-fit:contain; }

/* Combiner + Trash stack */
.slot-stack{ display:flex; flex-direction:column; gap:12px; }
.drop-zone{
  min-height:84px; border-radius:14px; padding:8px; display:flex; justify-content:center; align-items:center;
  border:2px dashed #b9a88c; background:#fbf7ee;
}
.drop-zone:hover{ background:#f6efdd; }
.combiner-visual{ position:relative; gap:14px; }
.combiner-visual .slot{
  width:84px; height:84px; border-radius:12px;               /* default look (overridden by .forge below) */
  background:#fff2d6; border:2px solid #d6ba84;
  box-shadow: inset 0 2px 8px rgba(0,0,0,.06);
  display:flex; align-items:center; justify-content:center;
}
.combiner-visual .slot.has-key{ background:#ffe7b5; }
.combiner-visual .plus{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  font-weight:900; font-size:26px; color:#a37424; pointer-events:none; opacity:.5;
}

.trash-visual{ background:#fff1f1; border-color:#e2b2b2; }
.trash-visual .trash-icon{ font-size:28px; opacity:.55 }

/* Inventory dock */
.inventory-dock{
  grid-column: 1 / 2;
  margin:16px 0 28px;
  padding:0;
  display:flex;
  justify-content:center;
}
.inventory{
  background:linear-gradient(180deg,#fff8e8,#f6ebcf);
  border:2px solid #d9c59b; border-radius:16px; box-shadow: var(--shadow);
  padding:12px 14px;
  display:inline-block;
}
.inventory h2{ display:none; }
.inventory-section{ background:transparent; box-shadow:none; padding:0 }
.key-grid{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-start; padding:10px; }
.inv-slot{
  width:56px; height:56px; border-radius:10px; background:#fff7e2;
  border:2px solid #d6ba84; box-shadow: inset 0 2px 8px rgba(0,0,0,.06);
  display:flex; align-items:center; justify-content:center; flex:0 0 56px;
}

/* Keys */
.key{
  width:48px; height:48px; max-width:48px; max-height:48px;
  border:1px solid #6f5a3e; border-radius:10px; background:#fff;
  box-shadow:0 2px 4px rgba(0,0,0,.1);
  object-fit:contain; -webkit-user-drag:element; user-drag:element; cursor:grab;
}
.key:active{ transform:scale(.96) }
.key.carried{ outline:2px dashed rgba(0,0,0,.15); outline-offset:2px; }

/* Inventory full shake */
@keyframes invShake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }
.inventory.full { animation:invShake .3s }

/* Popup: simple message + actions */
.popup{ position:fixed; inset:0; z-index:50; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.35); }
.popup.hidden{ display:none; }
.popup-card{
  min-width:300px; max-width:80vw; background:#fff8e8; border:2px solid #e3cfa6; border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.25); padding:16px 18px; text-align:center;
}
#popup-text{ font-weight:800; color:#5a3d1e; white-space:pre-line; }
.popup-actions{ display:flex; gap:10px; justify-content:center; margin-top:12px; }
.btn{
  border:2px solid #d1b379; background:#fff7dd; color:#5a3d1e; font-weight:800; padding:8px 12px; border-radius:10px; cursor:pointer;
}
.btn:hover{ background:#ffefc5; }
.btn.primary{ background:#ffe3a3; border-color:#c9a051; }
.btn.primary:hover{ background:#ffd777; }

/* Popup: durability / gamble bar */
.dur-card{
  min-width:340px; max-width:88vw; background:#fffdf4; border:2px solid #ead8b3; border-radius:16px;
  box-shadow:0 12px 30px rgba(0,0,0,.25); padding:16px 18px; text-align:center;
}
.dur-title{ font-weight:900; color:#5a3d1e; margin-bottom:10px; }
.dur-bar{
  position:relative; height:26px; border-radius:14px; overflow:hidden; border:2px solid #ccb487; background:#f8f0d9;
  display:flex; width:320px; margin:0 auto 8px;
}
.dur-red{ background:#f4b5b5; height:100%; }
.dur-green{ background:#bff0c3; height:100%; flex:1; }
.dur-cursor{
  position:absolute; top:-6px; width:24px; height:38px; border-radius:6px; background:#fff; border:2px solid #a97b2a;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
  left:0; transform:translateX(-50%);
}
.dur-caption{ font-weight:700; color:#5a3d1e; }

/* Toast (unused) */
.toast{ margin-top:8px; font-weight:700; color:#3b5d27; text-shadow:0 1px 0 #fff }

/* Accessibility focus */
.lock:focus-within img, .drop-zone:focus-within, .letter:focus{
  outline:3px solid #ffcc66; outline-offset:3px;
}

/* ---------- RUNE FORGE LOOK (Combiner) ---------- */
.combiner-visual.forge{
  position:relative;
  padding:22px 18px 24px;
  border:0;
  background:
    radial-gradient(120% 120% at 50% -10%, #fff9e8 0%, #f3e4c2 50%, #e3cfaa 100%);
  box-shadow: var(--shadow);
  border-radius:16px;
  overflow:hidden;
}

/* Stone ring */
.combiner-visual.forge::before{
  content:"";
  position:absolute; inset:10px 12px;
  border-radius:14px;
  background:
    radial-gradient(80% 80% at 50% 50%, #e6d6b1 0 60%, transparent 61%),
    conic-gradient(from 0deg, #c9b68a, #bba67c, #c9b68a);
  -webkit-mask:
    radial-gradient(80% 80% at 50% 50%, #000 59%, transparent 61%); /* hole */
  mask:
    radial-gradient(80% 80% at 50% 50%, #000 59%, transparent 61%);
  box-shadow:
    inset 0 6px 18px rgba(0,0,0,.15),
    inset 0 -2px 10px rgba(0,0,0,.08);
  opacity:.75;
}

/* etched runes/dots on the ring */
.combiner-visual.forge::after{
  content:"•   ◇   •   ◯   •   ✶   •   ◇   •   ◯   •   ✶";
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  letter-spacing:.6em;
  font-size:12px; font-weight:900;
  color:#b49a69; opacity:.55; pointer-events:none;
}

/* circular “wells” for keys (override base) */
.combiner-visual.forge .slot{
  width:88px; height:88px; border-radius:999px;
  background:#fff3d8;
  border:2px solid #d6ba84;
  box-shadow:
    inset 0 4px 12px rgba(0,0,0,.10),
    0 2px 0 rgba(177,138,91,.9);
  display:flex; align-items:center; justify-content:center;
}
.combiner-visual.forge .slot.has-key{ background:#ffe9b9; }

/* replace the + with a rune and make it float */
.combiner-visual.forge .plus{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  font-size:24px; font-weight:900; color:#a37424; opacity:.75;
}
.combiner-visual.forge .plus::before{ content:"◇"; }

/* subtle slot layout tweak */
.combiner-visual.forge .slot.a{ margin-right:42px; }
.combiner-visual.forge .slot.b{ margin-left:42px; }

/* fuse/glow when a combination succeeds */
@keyframes forgePulse {
  0% { box-shadow:0 0 0 rgba(255,208,96,0.0), inset 0 6px 18px rgba(0,0,0,.15); }
  40%{ box-shadow:0 0 32px rgba(255,208,96,.65), inset 0 6px 18px rgba(0,0,0,.15); }
  100%{ box-shadow:0 0 0 rgba(255,208,96,0.0), inset 0 6px 18px rgba(0,0,0,.15); }
}
.combiner-visual.forge.forge-fuse::before{ animation:forgePulse .9s ease-out; }

/* traveling spark */
@keyframes spark {
  0%   { transform:translate(-70px,-2px) scale(.9); opacity:0; }
  40%  { opacity:1; }
  100% { transform:translate(70px,2px) scale(1.1); opacity:0; }
}
.combiner-visual.forge.forge-fuse .plus::after{
  content:"";
  position:absolute; left:50%; top:50%;
  width:14px; height:14px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #fff, #ffe7a6 60%, rgba(255,186,64,.7) 100%);
  filter:blur(.2px);
  animation:spark .9s ease-out forwards;
}

/* ---------- SCRAP BIN LOOK ---------- */
.trash-visual.scrap{
  background:
    radial-gradient(120% 120% at 50% -10%, #fff1f1 0%, #ffe7e7 60%, #f6d5d5 100%);
  border:2px dashed #e2b2b2;
  position:relative;
  padding:24px 10px;
}
.trash-visual.scrap::before{
  content:"SCRAP BIN";
  position:absolute; top:6px; left:50%; transform:translateX(-50%);
  font-weight:900; font-size:12px; color:#b88282; letter-spacing:.12em;
  opacity:.7;
}
.trash-visual.scrap .trash-icon{
  font-size:30px; opacity:.55;
}
